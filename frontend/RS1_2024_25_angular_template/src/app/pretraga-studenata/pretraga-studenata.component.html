<div class="search-container">
  <div class="search-header">
    <h4>Pretražite studente</h4>
    <button class="close-button" (click)="openCloseSectionModal()">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <!-- Forma sa filterima -->
  <div class="search-form">
    <div class="search-input-group">
      <input
        type="text"
        placeholder="Ime ili Prezime"
        [(ngModel)]="searchValue"
        (input)="searchTerm.next($any($event.target).value)"
      />
    </div>
    <div class="search-input-group">
      <select (change)="filterStudents()" [(ngModel)]="selectedCity">
        <option value="undefined" disabled selected hidden>
          Izaberite grad
        </option>
        <option *ngFor="let city of cities" [value]="city.id">
          {{ city.name }}
        </option>
      </select>
    </div>

    <div class="search-input-group">
      <select (change)="filterStudents()" [(ngModel)]="selectedGrade">
        <option value="" disabled selected hidden>Izaberite razred</option>
        <option *ngFor="let grade of grades" [value]="grade">
          {{ grade }}
        </option>
      </select>
    </div>

    <div class="search-input-group">
      <select (change)="filterStudents()" [(ngModel)]="selectedSchoolType">
        <option value="" disabled selected hidden>Izaberite tip škole</option>
        <option *ngFor="let school of schoolTypes" [value]="school.value">
          {{ school.name }}
        </option>
      </select>
    </div>
  </div>

  <!-- Tabela sa rezultatima -->
  <div *ngIf="students && students.length > 0" class="results-container">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>#</th>
          <th>Ime</th>
          <th>Prezime</th>
          <th>Email</th>
          <th>Grad</th>
          <th>Razred</th>
          <th>Škola</th>
          <th>Akcija</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let student of students">
          <td>{{ student.id }}</td>
          <td>{{ student.myAppUser.firstName }}</td>
          <td>{{ student.myAppUser.lastName }}</td>
          <td>{{ student.myAppUser.email }}</td>
          <td>{{ student.myAppUser.city?.name }}</td>
          <td>{{ student.grade }}</td>
          <td>{{ formatEducationlevel(student.educationLevel) }}</td>
          <td>
            <button class="btn btn-warning" (click)="editStudent(student)">
              <i class="far fa-edit"></i>
              Uredi
            </button>
            <button class="btn btn-danger" (click)="deleteStudent(student.id)">
              <i class="far fa-trash-alt"></i>
              Obriši
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="totalCount === 0" class="no-results">
    Nema studenata koji odgovaraju pretrazi.
  </div>

  <div *ngIf="totalCount > 0" class="no-results">
    Broj rezultata koji odgovaraju pretrazi: {{ totalCount }}
  </div>

  <div *ngIf="totalCount > pageSize" class="pagination-container">
    <button
      (click)="changePage(currentPage - 1)"
      [disabled]="currentPage === 1"
    >
      <i class="fas fa-chevron-left"></i>
    </button>
    <span> {{ currentPage }} od {{ getTotalPages() }}</span>
    <button
      (click)="changePage(currentPage + 1)"
      [disabled]="currentPage === getTotalPages()"
    >
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>

  <div *ngIf="editingStudent" class="edit-form-container">
    <div class="edit-form">
      <h4>Uredi podatke studenta</h4>
      <form (ngSubmit)="saveStudent()">
        <div class="form-group">
          <label for="firstName">Ime</label>
          <input
            type="text"
            id="firstName"
            [(ngModel)]="editingStudent.myAppUser.firstName"
            name="firstName"
            required
          />
        </div>

        <div class="form-group">
          <label for="lastName">Prezime</label>
          <input
            type="text"
            id="lastName"
            [(ngModel)]="editingStudent.myAppUser.lastName"
            name="lastName"
            required
          />
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            [(ngModel)]="editingStudent.myAppUser.email"
            name="email"
            required
          />
        </div>

        <div class="form-group">
          <label for="city">Grad</label>
          <select
            id="city"
            [(ngModel)]="editingStudent.myAppUser.city.id"
            name="city"
            required
          >
            <option *ngFor="let city of cities" [value]="city.id">
              {{ city.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <button type="submit" class="btn btn-success">Spremi izmjene</button>
          <button type="button" class="btn btn-danger" (click)="cancelEdit()">
            Otkaži
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="action-buttons">
    <button class="btn btn-reset" (click)="clearSearch()">
      <i class="fas fa-refresh"></i>
      Resetuj filtere
    </button>
  </div>

  <!-- Confirmation Modal -->
  <div
    *ngIf="showConfirmModal"
    class="modal-overlay"
    (click)="onOverlayClick($event)"
  >
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Potvrda zatvaranja</h3>
        <p class="modal-message">
          Da li ste sigurni da želite napustiti formu za uređivanje?
        </p>
      </div>
      <div class="modal-actions">
        <button class="btn-danger" (click)="confirmClose()">Da, zatvori</button>
        <button class="btn-outline" (click)="cancelClose()">Ne, ostani</button>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div
    *ngIf="showConfirmModalDeletion"
    class="modal-overlay"
    (click)="onOverlayClick($event)"
  >
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Potvrda brisanja</h3>
        <p class="modal-message">
          Da li ste sigurni da želite obrisati odabranog studenta?
        </p>
      </div>
      <div class="modal-actions">
        <button class="btn-danger" (click)="confirmDeletion()">
          Da, obriši
        </button>
        <button class="btn-outline" (click)="cancelDelete()">
          Ne, odustani
        </button>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div
    *ngIf="showConfirmCloseSectionModal"
    class="modal-overlay"
    (click)="onOverlayClick($event)"
  >
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Potvrda zatvaranja</h3>
        <p class="modal-message">
          Da li ste sigurni da želite napustiti sekciju za studente?
        </p>
      </div>
      <div class="modal-actions">
        <button class="btn-danger" (click)="goBackToAdmin()">
          Da, zatvori
        </button>
        <button class="btn-outline" (click)="cancelCloseSection()">
          Ne, ostani
        </button>
      </div>
    </div>
  </div>
</div>
